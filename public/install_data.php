<?php

/*################################*\
|# - Ahlulbayt Portal             #|
|# - v1.0 beta                    #|
|# - Developed by Ahlulbayt Group #|
|# - 2011                         #|
\*################################*/

require_once __DIR__ . '/../vendor/autoload.php';

use Dotenv\Dotenv;

$dotenv = Dotenv::createImmutable(__DIR__ . '/../');
$dotenv->load();

$db_host = $_ENV['DB_HOST'];
$db_name = $_ENV['DB_NAME'];
$db_user = $_ENV['DB_USER'];
$db_pass = $_ENV['DB_PASS'];

try {
    $pdo = new PDO("mysql:host=$db_host", $db_user, $db_pass);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
    $pdo->exec("CREATE DATABASE IF NOT EXISTS `$db_name` CHARACTER SET utf8 COLLATE utf8_general_ci;");
    $pdo->exec("USE `$db_name`");

    // Create `cats` table
    $pdo->exec("
        CREATE TABLE IF NOT EXISTS `cats` (
          `id` int(11) NOT NULL auto_increment,
          `title` text NOT NULL,
          PRIMARY KEY  (`id`)
        ) ENGINE=MyISAM DEFAULT CHARSET=utf8 AUTO_INCREMENT=1;
    ");

    // Create `links` table
    $pdo->exec("
        CREATE TABLE IF NOT EXISTS `links` (
          `id` int(11) NOT NULL auto_increment,
          `title` text NOT NULL,
          `secid` int(11) NOT NULL,
          `url` text NOT NULL,
          `status` int(1) NOT NULL,
          PRIMARY KEY  (`id`)
        ) ENGINE=MyISAM DEFAULT CHARSET=utf8 AUTO_INCREMENT=1;
    ");

    // Create `pages` table
    $pdo->exec("
        CREATE TABLE IF NOT EXISTS `pages` (
          `id` int(11) NOT NULL auto_increment,
          `title` text NOT NULL,
          `content` text NOT NULL,
          PRIMARY KEY  (`id`)
        ) ENGINE=MyISAM DEFAULT CHARSET=utf8 AUTO_INCREMENT=1;
    ");

    // Create `posts` table
    $pdo->exec("
        CREATE TABLE IF NOT EXISTS `posts` (
          `id` int(11) NOT NULL auto_increment,
          `title` text NOT NULL,
          `cat_id` int(11) NOT NULL,
          `text` text NOT NULL,
          `source` text NOT NULL,
          `status` int(1) NOT NULL,
          PRIMARY KEY  (`id`)
        ) ENGINE=MyISAM DEFAULT CHARSET=utf8 AUTO_INCREMENT=1;
    ");

    // Create `settings` table
    $pdo->exec("
        CREATE TABLE IF NOT EXISTS `settings` (
          `title` varchar(255) NOT NULL,
          `description` text NOT NULL,
          `style` varchar(255) NOT NULL,
          `rights` text NOT NULL,
          `message` text NOT NULL
        ) ENGINE=MyISAM DEFAULT CHARSET=utf8;
    ");

    // Create `online_users` table
    $pdo->exec("
        CREATE TABLE IF NOT EXISTS `online_users` (
          `ip_address` VARCHAR(45) NOT NULL PRIMARY KEY,
          `timestamp` INT(11) NOT NULL
        ) ENGINE=MyISAM DEFAULT CHARSET=utf8;
    ");

    // Insert data
    $pdo->exec("INSERT INTO `cats` (`id`, `title`) VALUES
        (1, 'سير أهل البيت (ع)'),
        (2, 'أدعية الأيام'),
        (3, 'المناجاة الـ15'),
        (4, 'أحداث وفضائل الشهور')");

    $pdo->exec("INSERT INTO `links` (`id`, `title`, `secid`, `url`, `status`) VALUES
        (1, 'الصفحة الرئيسية', 1, '?act=home', 1),
        (2, 'المعصومين الـ14 (ع)', 2, '?act=pages&id=1', 1),
        (3, 'تفسير الإختلاجات', 3, '?act=pages&id=2', 1),
        (4, 'سير أهل البيت (ع)', 4, '?act=cats&id=1', 1),
        (5, 'أدعية الأيام', 5, '?act=cats&id=2', 1),
        (6, 'المناجاة الـ15', 6, '?act=cats&id=3', 1),
        (7, 'أحداث وفضائل الشهور', 7, '?act=cats&id=4', 1)");

    $pdo->exec("INSERT INTO `pages` (`id`, `title`, `content`) VALUES
        (1, 'المعصومين الـ14 (عليهم السلام)', 'الرسول الأعظم (ص).\r\nالإمام علي بن أبي طالب (ع).\r\nالسيدة فاطمة الزهراء (ع).\r\nالإمام الحسن بن علي (ع).\r\nالإمام الحسين بن علي (ع).\r\nالإمام علي بن الحسين السجاد (ع).\r\nالإمام محمد بن علي الباقر (ع) .\r\nالإمام جعفر بن محمد الصادق (ع).\r\nالإمام موسى بن جعفر الكاظم (ع).\r\nالإمام علي بن موسى الرضا (ع).\r\nالإمام محمد بن علي الجواد (ع).\r\nالإمام علي بن محمد الهادي (ع).\r\nالإمام الحسن بن علي العسكري (ع).\r\nالإمام الحجة المهدي المنتظر (عج).'),
        (2, 'تفسير الإختلاجات للإمام جعفر الصادق (ع)', 'روي عن الإمام جعفر الصادق (ع) أنه قال لعبد له اسمه «معلى» : يامعلى إن الإختلاج فيه زجر وتخويف وموعظة.\r\nفقال : جُعلت فداك بين لي , فقال : أعلم أن ذلك علم يقين ولا شك ولا ريب.\r\nأفهم إختلاجات ...\r\n\r\nالرأس واليافوخ : إصابة ملك وشرف ومال وذكر جميل.\r\nالرأس : خير ومحبة وصحة في الرأس.\r\nمابين الرأس واليافوخ : يصيبه خير.\r\nشق الرأس الأيمن : رزق واسع.\r\nشق الرأس الأيسر : سفر فيه خير, وفي رواية أنه سرور.\r\nالجبين «الجبهة» : إصابة خير, وفي رواية يُخشى عليه من سلطان.\r\nالصدع الأيمن : فرح وسرور, وفي رواية موت قريب له.\r\nالصدع الأيسر : هم يلحقه .. أو صحة جسم وقرار عين, وفي رواية موت قريب وشفاء مريض من بيته.\r\nالحاجب الأيمن : إصابة خير .. أو تحول مما يكره أو يسافر, وفي رواية يرى من يحب.\r\nالحاجب الأيسر : إصابة فرح .. وقيل حديث يغبطه أو مرض يصيبه.\r\nمابين العين اليمنى : يُصلح حاله.\r\nجفن العين الأعلى من اليمنى : يتحدث الناس فيه بما يكره.\r\nجفن العين الأسفل من اليمنى : يتحدث الناس فيه بخير.\r\nجفن العين الأعلى من اليسرى : يلتقي بغائب .. وفي رواية سرور وغبطة, وفي رواية يتحدث الناس فيه بخير.\r\nجفن العين الأسفل من اليسرى : يلتقي بغائب .. وفي رواية سرور وغبطة.\r\nمؤخرة العين اليمنى : يموت له ميت من بيته.\r\nمؤخرة العين اليسرى : يلتقي بغائب.\r\nالعين اليمنى كله : رزق يأتيه من بعض السلاطين وكرامة.\r\nالعين اليسرى كلها : إصابة عز وغبطة وكرامة وسرور.\r\nالعينين : صحة في الجسم.\r\nجنب الأنف الأيمن : ينجو من شر من يخافه.\r\nجنب الأنف الأيسر : تلقاه مضرة .. وفي رواية خير ونعمة.\r\nالأنف كله : مال كثير ونعمة.\r\nالأذن اليمنى : يُمنح كلاما يعجبه .. يأتي أرض غير أرضه ويصيب مالا ويرجع سالما.\r\nالأذن اليسرى : قدر يصيبه ثم ينجو .. وإن إمرأة تتزوج.\r\nالخد الأيمن : يسمع حديث شر, وفي رواية يصح جسمه ويأتيه من يحب.\r\nالخد الأيسر : يأتيه داء في جسمه ومرض.\r\nالشفتين : كلام يغمه.\r\nالشفة العليا : يدل على إنسان يبغضه.\r\nالشفة السفلى : يقع في خصومة ويتكلم الناس بما يكره.\r\nاللسان بأسره : صحة من تعب.\r\nاللسان الأيمن : من داخله شر.\r\nاللسان الأيسر : صلاح أمره وكلامه.\r\nجانب الفم الأيمن : يجد خير.\r\nجانب الفم الأيسر : يسمع ما يحبه.\r\nالفم كله : يعانق من يحب.\r\nجانب العنق الأيمن : يأتيه خير وسرور.\r\nجانب العنق الأيسر : إصابة خير وسعة ومال كثير.\r\nالعنق كله : نعوذ بالله من ذلك ومن الشيطان الرجيم.\r\nالمنكب اليمن : هم وحزن ومصيبة.\r\nالمنكب الأيسر : يعمل عملا يكسب فيه خير وفي رواية يكشف عليه علم كثير.\r\nالعضد الأيمن : مرض يصيبه وينجو منه.\r\nالعضد الأيسر : فرح يأتيه.\r\nالمرفق الأيمن : وجع شديد.\r\nالمرفق الأيسر : فرح وسرور.\r\nالذراع اليمنى : معانقة حبيب, وفي رواية معانقة حبيبة إمرأة يحبها ويدخل على سلطان وينال منه خير.\r\nالذراع اليسرى : يأتيه رزق واسع.\r\nالراحة اليمى : يُخاصم ويُضرب, وفي رواية يدل على خُصومة ويضرب بيد أو بعصا أو سوط.\r\nإبهام اليد اليمنى : إصابة كرامة.\r\nإبهام اليد اليسرى : إصابة رفعة وفي رواية خصومة من صديق.\r\nسبابة اليد اليمنى : حديث سوء يسمعه.\r\nسبابة اليد اليسرى : يبشر بنصر.\r\nخنصر اليد اليمنى : يأتيه رزق.\r\nخنصر اليد اليسرى : فرح وقوة.\r\nاليد اليمنى : يصيبه خير.\r\nاليد اليسرى : يأتيه غائب.\r\nالكف اليمنى : فرح وسرور.\r\nالكف اليسرى : فرح وسرور.\r\nالخاصرة اليمنى : تقر عينه.\r\nالخاصرة اليسرى : يتزوج من يريد.\r\nالصدر : يعانق من يحب.\r\nالثدي الأيمن : يكثر ماله.\r\nالثدي الأيسر : علو منزله.\r\nالفؤاد : فرح وسرور.\r\nالسرة : فرح وسرور.\r\nالذكر : فرح يأتيه, وفي رواية يفعل قبيحا ويقي الله تعالى.\r\nالبيضة اليمنى : تُقضى حوائجه.\r\nالبيصة اليسرى : نكاح جديد.\r\nالجانب من المتن الأيمن : رزق حرام.\r\nالجانب من المتن الأيسر : مولود يقر عينه.\r\nمابين السرة والعانة : جلالة وشرف.\r\nالعانة كلها : مولود يُسر به.\r\nالورك الأيمن : يفعل ما يُحمد عليه.\r\nالورك الأيسر : هم يزول عنه.\r\nالعجز الأيمن - الأيسر : فرح وسرور.\r\nالآلية اليمنى : فرح يأتيه.\r\nالآلية اليسرى : يُكذب عليه.\r\nالفخذ الأيمن : سرور يتجدد.\r\nالفخذ الأيسر : يملك دابة.\r\nالركبة اليمنى : صحبة سلطان.\r\nالركبة اليسرى : رفعة عند ملك.\r\nالساق اليمنى : خصومة أوسفر.\r\nالساق اليسرى : رزق جديد.\r\nالعقب الأيمن : يلقى ما يكره.\r\nالعقب الأيسر : رفعة من سلطان.\r\nالكعب الأيمن : هم يزول.\r\nالكعب الأيسر : فرح وغبطة.\r\nظاهر القدم اليمنى : يُكره كلامه.\r\nظاهر القدم اليسرى : يصدع حاله.\r\nباطن القدم اليمنى : صنعة بين الناس.\r\nباطن القدم اليسرى : منزلة جديدة.\r\nإبهام الرجل اليمنى - اليسرى : يفعل خير.\r\nسبابة الرجل اليمنى : يمرض ويبرأ.\r\nسبابة الرجل اليسرى : يُخاصم ويظفر.\r\nالوسطى من الرجل اليمنى : غنيمة تناله.\r\nالوسطى من الرجل اليمنى : يكثر ماله.\r\nبنصر الرجل اليمنى : فرح وقرة عين.\r\nبنصر الرجل اليسرى : كرامة في سفر.\r\nخنصر الرجل اليمنى : رزق واسع.\r\nخنصر الرجل اليسرى : يصل إليه مال.\r\nأصابع الرجل اليمنى كلها : تكبر في نفسه المعيشة.\r\nأصابع الرجل اليسرى كلها : تناله مشقة.\r\nالقدم اليمنى : يسافر ويغنم.\r\nالقدم اليسرى : يسافر ويغنم بأصدقاء.')");

    $pdo->exec("INSERT INTO `posts` (`id`, `title`, `cat_id`, `text`, `source`, `status`) VALUES
        (1, 'سيرة الرسول الأعظم محمد (ص)', 1, 'بطاقة الهوية:\r\nالاسم : الرسول الأعظم محمد (ص)\r\nاللقب : المصطفى\r\nالكنية : أبو القاسم\r\nاسم الأب : عبد الله بن عبد المطلب\r\nاسم الأم : امنة بنت وهب\r\nتاريخ الولادة : 17 ربيع الأول\r\nتاريخ الوفاة : 28 - صفر - 11 هـ\r\nمدة النبوة : 23 سنة\r\nمكان الدفن : المدينة المنورة\r\n\r\n\r\n● الولادة المباركة:\r\nفي السابع عشر من شهر ربيع الأول عام (570م) المعروف بعام الفيل أشرقت شمس مكّة بولادة النور والهدى. ليعمّ اشعاعها كافّة أرجاء المعمورة.\r\nومن أكرم بيت من بيوت العرب انحدر رسول البشرية وخاتم الأنبياء من الأصلاب الشامخة والأرحام المطهّرة. ليحظى بولادته أبوان كريمان هما: عبد الله بن عبد المطلب وامنة بنت وهب. ولم يتسنّ لهذا المولود الكريم أن ينعم بالرعاية والحنان الأبوي. حيث توفي والده وهو جنين في بطن أمه. وقيل: بعد ولادته بشهرين. وقد تشرّفت بإرضاعه حليمة السعدية. حيث أمضى في بادية (بني سعد) زهاء خمسة أعوام.\r\n\r\n● مرحلة الطفولة:\r\nفي السنة السادسة من عمره الشريف توفيت والدته، فأولاه جدّه عبد المطلب كامل الرعاية. وكان يقول: "إن لإبني هذا لشأناً" لِما توسّم فيه من البركات التي رافقته منذ ولادته. وفي السنة الثامنة من عمره الشريف توفي جدّه عبد المطلب. فانتقل إلى كفالة عمه أبي طالب بناءً على وصية جدّه.\r\nفكان أبو طالب خير كفيل له في صغره وخير ناصر له في دعوته.\r\n\r\n● مرحلة الشباب:\r\nلم يبلغ النبي محمد (ص) سنّ الشباب حتى اشتهر بين الناس بالصدق والاستقامة وكرم الأخلاق فلقّب ب"الصادق الأمين" وتميّز بالوعي والحكمة.\r\n\r\n● البعثة:\r\nنبذ النبي محمد (ص) كل مظاهر الحياة الجاهلية. وكان يتردد إلى غار حراء. يتعبّد فيها. وفي الأربعين من عمره المبارك هبط عليه جبرائيل (ع) في غار حراء بالوحي: "إقرأ باسم ربك الذي خلق.." وبذلك ابتدأ الدعوة الإلهية إلى الناس كافة لتخرجهم من الظلمات إلى النور، وكانت زوجته خديجة أول من صدق به من النساء, وكان أول من آمن بالدعوة من الرجال علي بن أبي طالب (ع).\r\n\r\n● الدعوة إلى الإسلام:\r\nتحمّل النبي محمد (ص) مسؤولية الدعوة والتبليغ فاستجاب له حوالى (40) شخصاً. خلال السنوات الثلاث الأُوَل المعروفة بالمرحلة السرّية للدعوة. عمل فيها على بناء النواة الأولى للدعوة. وتركيز الدعائم لها, وبعد ذلك دعا عشيرته الأقربين إلى الإسلام، فكانت الاستجابة محدودة، ثم أعلن الدعوة لجميع الناس.\r\n', 1),
        (2, 'سيرة السيدة الصّديقة فاطمة الزهراء (ع)', 1, 'بطاقة الهوية:\r\nالاسم : الصديقة فاطمة الزهراء (ع)\r\nاللقب : الزهراء\r\nالكنية : أم الأئمة\r\nاسم الأب : النبي محمد بن عبد الله (ص)\r\nاسم الأم : خديجة بنت خويلد\r\nتاريخ الولادة : 20 - جمادى الآخرة - 5 بعد البعثة\r\nتاريخ الشهادة: 3 - جمادى الآخرة - 11 هـ\r\nمكان الدفن: مجهول عند الناس\r\n\r\n\r\n● حياة السيدة الزهراء (ع):\r\nولدت السيدة فاطمة الزهراء (ع) بعد مبعث الرسول (ص) بخمس سنين في بيت الطهارة والإيمان لتكون رمز المرأة المسلمة وسيدة نساء العالمين وأم الأئمة حيث كانت القطب الجامع بين النبوة والامامة. فاطمة وأبوها وبعلها وبنوها.\r\n\r\n● طفولة فاطمة (ع):\r\nنشأت فاطمة الزهراء (ع) في بيت النبوة ومهبط الرسالة فكان أبوها رسول الله (ص) يزقها العلوم الالهية ويفيض عليها من معارفه الربانية.\r\nوشاءت حكمة الله تعالى أن تعاني هذه الأبنة الطاهرة ما كان يعانيه أبوها من أذى المشركين فيما كان يدعوهم الى عبادة الإله الواحد. ولم تكد تبلغ الخامسة من عمرها حتى توفيت أمها خديجة فكانت تلوذ بأبيها رسول الله (ص) الذي بات سلوتها الوحيدة فوجدت عنده كل ما تحتاجه من العطف والحنان والحب والاحترام. ووجد فيها قرة عينه وسلوة أحزانه فكانت في حنانها عليه واهتمامه به كالأم الحنون حتى قال عنها: "فاطمة أم أبيها".\r\n\r\n● هجرة فاطمة (ع):\r\nبعد أن غادر النبي (ص) مكة متوجهاً الى المدينة لحق الامام علي (ع) به ومعه الفواطم، ومنهم فاطمة الزهراء (ع)، وكان عمرها انذاك سبع سنوات، فلحقوا جميعاً بالنبي (ص) الذي كان بانتظارهم ودخلوا المدينة معاً.\r\n\r\n● زواج فاطمة (ع) من علي (ع):\r\nما بلغت فاطمة الزهراء (ع) التاسعة من العمر حتى بدا عليها كل ملامح النضوج الفكري والرشد العقلي فتقدم سادات المهاجرين والأنصار لخطبتها طمعاً بمصاهرة النبي (ص) ولكنه كان يردهم بلطف معتذراً بأن أمرها الى ربها.\r\nوخطبها علي (ع) فوافق النبي (ص) ووافقت فاطمة وتمّ الزواج على مهر قدره خمسمائة درهم، فباع علي درعه لتأمين هذا المهر ولتأثيث البيت الذي سيضمهما فكان أن بسط أرض الحجرة بالرمل ونصب عوداً لتُعلق به القربة واشترى جرةً وكوزاً، وبسط فوق الرمل جلد كبش ومخدة من ليف.\r\nلقد كان هذا البيت المتواضع غنياً بما فيه من القيم والأخلاق والروح الايمانية العالية فبات صاحباه زوجين سعيدين يعيشان في ظل المحبة والوئام.\r\n', 1)");

    $pdo->exec("INSERT INTO `settings` (`title`, `description`, `style`, `rights`, `message`) VALUES
        ('بوابة أهل البيت (ع)', 'بوابة أهل البيت (ع)', 'default', 'بوابة أهل البيت (ع)', 'قال رسول الله (ص): «إِنَّمَا مَثَلُ أَهْلِ بَيْتِي فِيكُم كَمَثَلِ سَفِينَةِ نُوحٍ مَن رَكِبَهَا نَجَا وَمَنْ تَخَلَّفَ عَنْهَا غَرِق»')");

    echo "Database and tables created successfully.";

} catch (PDOException $e) {
    die("Database installation failed: " . $e->getMessage());
}
